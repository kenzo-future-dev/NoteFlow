<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteFlow</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="layout collapsed" id="layout">
        <header>
            <div class="brand">NoteFlow</div>
        </header>

        <nav id="sidebar" aria-label="Menu principal" aria-hidden="true">
            <ul>
                <li><a href="inicio.html">Início</a></li>
                <li><a href="notas.html">Notas</a></li>
                <li><a href="arquivos.html">Arquivos</a></li>
                <li><a href="config.html">Configurações</a></li>
            </ul>
        </nav>

        <button class="nav-toggle" id="navToggle" aria-controls="sidebar" aria-expanded="false" title="Abrir/fechar menu">›</button>

        <main>
            <!-- Conteúdo carregado dinamicamente aqui -->
            <article id="content" role="article">
                <h1>Conteúdo principal</h1>
                <p>Carregue uma página do menu.</p>
            </article>
        </main>

        <footer>
            © 2025 NoteFlow
        </footer>
    </div>

    <script>
    (function(){
        const layout = document.getElementById('layout');
        const toggle = document.getElementById('navToggle');
        const sidebar = document.getElementById('sidebar');
        const content = document.getElementById('content');

        // --- função de estado do menu (mantém seu comportamento atual) sadasdsadas---
        function setState(collapsed){
            layout.classList.toggle('collapsed', collapsed);
            toggle.setAttribute('aria-expanded', String(!collapsed));
            sidebar.setAttribute('aria-hidden', String(collapsed));
            toggle.textContent = collapsed ? '›' : '‹';
        }
        setState(true);

        // --- carregar página via fetch e injetar dentro do #contents ---
        async function loadIntoArticle(url, push = true){
            try{
                const res = await fetch(url, {cache: "no-store"});
                if(!res.ok) throw new Error('Falha ao carregar: ' + res.status);
                const text = await res.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                // tenta encontrar um <main> ou <article> na página alvo; senão usa body
                const source = doc.querySelector('main') || doc.querySelector('article') || doc.body;
                content.innerHTML = source ? source.innerHTML : text;

                // atualiza título da página com título do documento carregado
                const newTitle = doc.querySelector('title');
                if(newTitle) document.title = newTitle.textContent;

                if(push) history.pushState({url}, '', url);
            }catch(err){
                content.innerHTML = '<h2>Erro</h2><p>Não foi possível carregar o conteúdo.</p>';
                console.error(err);
            }
        }

        // --- intercepta cliques no menu para carregar dentro do article ---
        sidebar.addEventListener('click', (ev) => {
            const a = ev.target.closest('a');
            if(!a) return;
            const href = a.getAttribute('href');
            // se href for uma âncora ou externo, deixa padrão
            if(!href || href.startsWith('#') || href.startsWith('http')) return;
            ev.preventDefault();
            loadIntoArticle(href, true);
        });

        // --- suporta voltar/avançar do histórico ---
        window.addEventListener('popstate', (ev) => {
            const state = ev.state;
            if(state && state.url) loadIntoArticle(state.url, false);
            else {
                // sem estado -> carregar página atual (útil ao recarregar)
                loadIntoArticle(location.pathname, false);
            }
        });

        // --- comportamento do toggle (clique simples) ---
        toggle.addEventListener('click', () => {
            const collapsed = !layout.classList.contains('collapsed');
            setState(collapsed);
        });

        // opcional: ao abrir a página, carregar 'inicio.html' automaticamente (se existir)
        const initial = 'inicio.html';
        fetch(initial, {method:'HEAD'}).then(r => {
            if(r.ok) loadIntoArticle(initial, false);
        }).catch(()=>{ /* ignora se não existir */ });

    })();
    </script>
</body>
</html>